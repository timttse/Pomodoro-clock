<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  	<link href='https://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
  	<!-- <link rel="stylesheet" type="text/css" href="styles.css"> -->
  	<script src="clock.js"></script>
  	<!-- <script src="script.js"></script> -->
	<title>Pomodoro Clock</title>

	<script>
		var currentTimer='';

		function startTimers(timer1,timer2){
			currentTimer=timer1.name;
			$(".currentTimer").text(currentTimer);
			timer1.startTimer($(".countdown"),100);
			console.log(currentTimer);

			var t=setInterval(function(){
				// console.log(timer1.getMilliseconds());
				if(timer1.getMilliseconds()===0){
					clearInterval(t);
					timer1.stopTimer();
					timer1.reset();
					$(".countdown").text(timer2.timeString);
					startTimers(timer2,timer1);
				}
			},100);
		}

		function stopTimers(timer1,timer2){
			if(timer1.isRunning()){
				timer1.stopTimer();
			}
			if(timer2.isRunning()){
				timer2.stopTimer();
			}
		}

		function timersRunning(timers){
			var args = Array.prototype.slice.call(arguments);

			// if at least one timer is running, return true, else false
			return args.some(function(elem){
				return elem.isRunning();
			});
		}

		$(document).ready(function(){
			
			// create session timer
			var sessionInMil=$(".time").val()*60*1000;
			var s=new Clock("Session",sessionInMil);

			// create break timer
			var breakInMil=$(".break").val()*60*1000;
			var b=new Clock("Break",breakInMil);

			// set global current timer
			currentTimer=s.name;

			// Set current timer text
			$(".currentTimer").text(s.name);

			// Set timer text to session timer
			$(".countdown").text(s.getMinutes());

			// session input value change
			$(".time").change(function(){
				sessionInMil=$(this).val()*60*1000
				s.setMilliseconds(sessionInMil);
				if(currentTimer===s.name){
					$(".countdown").text(s.timeString());
					s.stopTimer();
				}
			});

			//break input value cahnge
			$(".break").change(function(){
				breakInMil=$(this).val()*60*1000
				b.setMilliseconds(breakInMil);
				if(currentTimer===b.name){
					$(".countdown").text(b.timeString());
					b.stopTimer();
				}
			});


			// start button
			$(".startTimer").click(function(){

				if(!s.isRunning() && !b.isRunning()) {
					if(currentTimer==='' || currentTimer===s.name){
						startTimers(s,b);
					} else if (currentTimer='break'){
						startTimers(b,s);
					}
				}
			});

			// stop/pause button
			$(".stopTimer").click(function(){
				stopTimers(s,b);
			});

			$(".test").click(function(){
				console.log(timersRunning(s,b));
			});

	    });

	</script>

</head>
<body>
	<div class="container-fluid text-center">
		<div class="row">
		<div class="col-sm-6"><label>Break Length: </label><input class="break" type="text" value="2" /></div>
		<div class="col-sm-6"><label>Session Length: </label><input class="time" type="text" value="1" /></div>
		</div>
		<div class="currentTimer"></div>
		<div class="countdown"></div>
		<button class="stopTimer">Stop</button>
		<button class="startTimer">Start</button>
		<button class="test">Test</button>
	</div>
</body>
</html>