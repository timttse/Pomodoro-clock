<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  	<link href='https://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
  	<!-- <link rel="stylesheet" type="text/css" href="styles.css"> -->
  	<script src="clock.js"></script>
  	<!-- <script src="script.js"></script> -->
	<title>Pomodoro Clock</title>

	<script>
		var currentTimer='';

		function startTimers(timer1,timer2){
			currentTimer=timer1.name;
			$(".currentTimer").text(currentTimer);
			timer1.startTimer($(".countdown"),100);
			console.log(currentTimer);

			var t=setInterval(function(){
				// console.log(timer1.getMilliseconds());
				if(timer1.getMilliseconds()===0){
					clearInterval(t);
					timer1.stopTimer();
					timer1.reset();
					$(".countdown").text(timer2.timeString);
					startTimers(timer2,timer1);
				}
			},100);
		}

		function stopTimers(timer1,timer2){
			if(timer1.isRunning()){
				timer1.stopTimer();
			}
			if(timer2.isRunning()){
				timer2.stopTimer();
			}
		}

		function timersRunning(timers){
			var args = Array.prototype.slice.call(arguments);

			// if at least one timer is running, return true, else false
			return args.some(function(elem){
				return elem.isRunning();
			});
		}

		function changeTimer(timer,input){
			timer.setMilliseconds(input.val()*60*1000);
			if(currentTimer===timer.name){
				$(".countdown").text(timer.timeString());
				timer.stopTimer();
			}
		}

		$(document).ready(function(){
			
			// create session timer
			var sessionInMil=$(".session").val()*60*1000;
			var s=new Clock("Session",sessionInMil);

			// create break timer
			var breakInMil=$(".break").val()*60*1000;
			var b=new Clock("Break",breakInMil);

			// set global current timer
			currentTimer=s.name;

			// Set current timer text
			$(".currentTimer").text(s.name);

			// Set timer text to session timer
			$(".countdown").text(s.getMinutes());

			// session input value change
			$(".session").change(function(){
				changeTimer(s,$(this))
			});

			//break input value cahnge
			$(".break").change(function(){
				changeTimer(b,$(this))
			});


			// start button
			$(".startTimer").click(function(){

				if(!s.isRunning() && !b.isRunning()) {
					if(currentTimer==='' || currentTimer===s.name){
						startTimers(s,b);
					} else if (currentTimer='break'){
						startTimers(b,s);
					}
				}
			});

			// stop/pause button
			$(".stopTimer").click(function(){
				stopTimers(s,b);
			});

			$(".test").click(function(){
				console.log(timersRunning(s,b));
			});


			$(".sInc").click(function(){
				var add=+$(".session").val();
				$(".session").val(add+1);
				changeTimer(s,$(".session"));
				//console.log($(".break").val()++)
			});

			$(".sDec").click(function(){
				var dec=+$(".session").val();
				if(dec>1){
					$(".session").val(dec-1);
					changeTimer(s,$(".session"));
				}				
			});


			$(".bInc").click(function(){
				var add=+$(".break").val();
				$(".break").val(add+1);
				changeTimer(b,$(".break"));
				//console.log($(".break").val()++)
			});

			$(".bDec").click(function(){
				var dec=+$(".break").val();
				if(dec>1){
					$(".break").val(dec-1);
					changeTimer(b,$(".break"));
				}				
			});

	    });

	</script>
	<style>
		.wrapper{text-align: center;}
		.center{display:inline-block; min-width: 500px;}
		.timerSet{margin: 50px 0 30px 0;}
		.textInput{width:50px;}
		.currentTimer{margin:5px;}
		.countdown{margin:15px;}
	</style>

</head>
<body>
	<div class="wrapper text-center">
		<div class="container-fluid center">
			<div class="row timerSet justify-content-center">
				<div class="col-sm-6"><label class="text-center">Break Length</label><br/><button class="bDec">-</button><input class="break textInput text-center" type="text" value="2" /><button class="bInc">+</button></div>
				<div class="col-sm-6"><label class="text-center">Session Length</label><br/><button class="sDec">-</button><input class="session textInput text-center" type="text" value="1" /><button class="sInc">+</button></div>
			</div>
			<div><h3 class="currentTimer"></h3></div>
			<div><h2 class="countdown"></h2></div>
			<button class="stopTimer">Stop</button>
			<button class="startTimer">Start</button>
			<button class="test">Test</button>
		</div>
	</div>
</body>
</html>